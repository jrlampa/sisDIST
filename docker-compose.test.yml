version: "3.9"

services:
  backend-test:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: sisdist_backend_test
    environment:
      DATABASE_URL: sqlite+aiosqlite:///:memory:
      REDIS_URL: redis://localhost:6379/0
      SECRET_KEY: test-secret-key
      ENVIRONMENT: test
    command: pytest tests/ -v --tb=short --cov=app --cov-report=term-missing
    volumes:
      - ./backend:/app

  frontend-test:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: sisdist_frontend_test
    command: npm run test
    volumes:
      - ./frontend:/app
      - /app/node_modules
